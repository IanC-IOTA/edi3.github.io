<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>edi3 Notary Service 1.0 Specification - edi3 Standards by edi3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/style.css">

    <link rel="apple-touch-icon" sizes="57x57" href="/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/images/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
</head>

<body>

<header class="header">
    <div class="header-line">
        <div class="wrapper">
            <div id="mobile-menu-wrapper" class="mobile-menu">
                <button id="hamburger-menu" class="hamburger-menu">
                    <span>toggle menu</span>
                </button>
                <div id="mobile-menu" style="display: none;">
                    
                    <ul class="sidebar-menu">
    
    <li class="menu-title"><a href="/">Overview</a></li>
    <li><a  href="/governance/">Governance</a></li>
    <li><a  href="/business-case/">Business Case</a></li>
    <li><a  href="/glossary/">Glossary</a></li>
    <li class="menu-title"><a href="/semantic-specs/">Semantic Specs</a></li>
    <li><a  href="/trade/">Trade Domain</a></li>
    <li><a  href="/transport/">Transport Domain</a></li>
    <li><a  href="/regulatory/">Regulatory Domain</a></li>
    <li><a  href="/finance/">Finance Domain</a></li>
    <li><a  href="/unlocode/">UN Locode</a></li>
    <li><a  href="/codelists/">Code Lists</a></li>
    <li><a  href="/dictionary/">Dictionary</a></li>
    <li class="menu-title"><a href="/technical-specs/">Technical Specs</a></li>
    <li><a  href="/icl/">Inter Customs Ledger</a></li>
    <li><a  href="/identity/">Identity Provider</a></li>
    <li><a  href="/discovery/">Resource Discovery</a></li>
    <li><a  href="/description/">Resource Description</a></li>
    <li><a  href="/events/">Event Structure</a></li>
    <li><a  href="/notary/">Notary Service</a></li>
    <li class="menu-title"><a href="/tools-and-methods/">Tools and Methods</a></li>
    <li><a  href="/uml-profile/">UML Profile</a></li>
    <li><a  href="/api-ndr/">OpenAPI NDR</a></li>
    <li><a  href="/json-ld-ndr/">JSON-LD NDR</a></li>
    <li><a  href="/api-conformance/">API Conformance</a></li>
    <li><a  href="/model-interchange/">Model Interchange</a></li>
    <li class="menu-title"><a href="/community/">Community</a></li>
    <li><a href="http://eepurl.com/dMLfdU" target="_blank">Newsletter (subscribe)</a></li>
    <li><a href="https://join.slack.com/t/edi3/shared_invite/enQtNTY5OTkzMjQ0NjcyLTAxZGVlMzJmNWQ5MDBjOTRmMWViNGU0MzdhY2VkOWIwZWY3ODMxOWE4YTJmZjdiNTBkYzczZDk5Y2ViOWJlNzQ" target="_blank">Chat (join team)</a></li>
    <li><a  href="/github/">GitHub</a></li>
</ul>

                </div>
            </div>
            <a href="/" class="logo"><img src="/images/logo-horisontal-white.svg" alt="edi3"></a>
            <div class="header-search">
                <script>
                    (function() {
                        var cx = '002841699265932723855:7gvs7wrhud8';
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                    })();
                </script>
                <gcse:search></gcse:search>
            </div>
            
        </div>
    </div>
    <div class="header-content">
        <div class="wrapper">
            <div class="header-text-box">
                <div class="header-name">edi3 Standards</div>
                <div class="header-tagline">UN/CEFACT Standards for Web Developers</div>
            </div>
        </div>
    </div>
</header>
<script type="text/javascript">
    document.getElementById('hamburger-menu').onclick = function() {
        var nf = document.getElementById('mobile-menu');

        // Show and hide menu items when toggle is clicked
        if(nf.style.display==='none') {
            nf.style.display = 'block';
        }
        else {
            nf.style.display = 'none';
        }
    };

    window.addEventListener('click', function(e){
        if (!document.getElementById('mobile-menu-wrapper').contains(e.target)){
            document.getElementById('mobile-menu').style.display= 'none';
        }
    });
</script>

<div class="main-wrapper">
    <div class="main-content">
        <div class="page-sidebar">
            <ul class="sidebar-menu">
    
    <li class="menu-title"><a href="/">Overview</a></li>
    <li><a  href="/governance/">Governance</a></li>
    <li><a  href="/business-case/">Business Case</a></li>
    <li><a  href="/glossary/">Glossary</a></li>
    <li class="menu-title"><a href="/semantic-specs/">Semantic Specs</a></li>
    <li><a  href="/trade/">Trade Domain</a></li>
    <li><a  href="/transport/">Transport Domain</a></li>
    <li><a  href="/regulatory/">Regulatory Domain</a></li>
    <li><a  href="/finance/">Finance Domain</a></li>
    <li><a  href="/unlocode/">UN Locode</a></li>
    <li><a  href="/codelists/">Code Lists</a></li>
    <li><a  href="/dictionary/">Dictionary</a></li>
    <li class="menu-title"><a href="/technical-specs/">Technical Specs</a></li>
    <li><a  href="/icl/">Inter Customs Ledger</a></li>
    <li><a  href="/identity/">Identity Provider</a></li>
    <li><a  href="/discovery/">Resource Discovery</a></li>
    <li><a  href="/description/">Resource Description</a></li>
    <li><a  href="/events/">Event Structure</a></li>
    <li><a  href="/notary/">Notary Service</a></li>
    <li class="menu-title"><a href="/tools-and-methods/">Tools and Methods</a></li>
    <li><a  href="/uml-profile/">UML Profile</a></li>
    <li><a  href="/api-ndr/">OpenAPI NDR</a></li>
    <li><a  href="/json-ld-ndr/">JSON-LD NDR</a></li>
    <li><a  href="/api-conformance/">API Conformance</a></li>
    <li><a  href="/model-interchange/">Model Interchange</a></li>
    <li class="menu-title"><a href="/community/">Community</a></li>
    <li><a href="http://eepurl.com/dMLfdU" target="_blank">Newsletter (subscribe)</a></li>
    <li><a href="https://join.slack.com/t/edi3/shared_invite/enQtNTY5OTkzMjQ0NjcyLTAxZGVlMzJmNWQ5MDBjOTRmMWViNGU0MzdhY2VkOWIwZWY3ODMxOWE4YTJmZjdiNTBkYzczZDk5Y2ViOWJlNzQ" target="_blank">Chat (join team)</a></li>
    <li><a  href="/github/">GitHub</a></li>
</ul>

        </div>
        <div class="page-content docs-content">
            
            <div class="spec-header">
                
                <ul>
                    <li>Spec ID: <p>notary/1</p>
</li>
                    <li><p><img src="http://rfc.unprotocols.org/spec:2/COSS/raw.svg" alt="raw" /></p>
</li>
                    <li>Editor: <p><a href="mailto:LIEW_Shujing@imda.gov.sg">Shujing Liew</a></p>
</li>
                    <li>Contributors: <p>Raymond, Rui Jie</p>
</li>
                </ul>
            </div>
            <div class="specs-toc">
    <!--<div class="specs-toc-title">Table of contents</div>-->
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#abstract">Abstract</a></li>
<li class="toc-entry toc-h1"><a href="#introduction">Introduction</a>
<ul>
<li class="toc-entry toc-h2"><a href="#goals">Goals</a></li>
<li class="toc-entry toc-h2"><a href="#use-cases">Use Cases</a>
<ul>
<li class="toc-entry toc-h3"><a href="#domain-name-server-dns">Domain Name Server (DNS)</a></li>
<li class="toc-entry toc-h3"><a href="#token-registry">Token Registry</a>
<ul>
<li class="toc-entry toc-h4"><a href="#non-transferable-document">Non-transferable Document</a>
<ul>
<li class="toc-entry toc-h5"><a href="#certificate-of-non-manipulation">Certificate of Non-Manipulation</a>
<ul>
<li class="toc-entry toc-h6"><a href="#preconditions">Preconditions</a></li>
<li class="toc-entry toc-h6"><a href="#prove-ownership-of-document-store">Prove Ownership of Document Store</a></li>
<li class="toc-entry toc-h6"><a href="#prove-document-issuance">Prove Document Issuance</a></li>
<li class="toc-entry toc-h6"><a href="#verification">Verification</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h4"><a href="#transferable-document">Transferable Document</a>
<ul>
<li class="toc-entry toc-h5"><a href="#bill-of-lading">Bill of Lading</a>
<ul>
<li class="toc-entry toc-h6"><a href="#preconditions-1">Preconditions</a></li>
<li class="toc-entry toc-h6"><a href="#prove-ownership-of-token-registry">Prove Ownership of Token Registry</a></li>
<li class="toc-entry toc-h6"><a href="#prove-document-issuance-1">Prove Document Issuance</a></li>
<li class="toc-entry toc-h6"><a href="#verification-1">Verification</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#data-model">Data Model</a>
<ul>
<li class="toc-entry toc-h2"><a href="#json-schema">JSON Schema</a></li>
<li class="toc-entry toc-h2"><a href="#json-schema-validator">JSON Schema Validator</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#basic-concept">Basic Concept</a>
<ul>
<li class="toc-entry toc-h2"><a href="#verification-method">Verification Method</a>
<ul>
<li class="toc-entry toc-h3"><a href="#overview-of-the-verification-methods">Overview of the verification methods</a>
<ul>
<li class="toc-entry toc-h4"><a href="#testdocument-document-boolean">test(document: Document): boolean</a></li>
<li class="toc-entry toc-h4"><a href="#skip-verificationfragment">skip(): VerificationFragment</a></li>
<li class="toc-entry toc-h4"><a href="#verifydocument-document-verificationfragment">verify(document: Document): VerificationFragment</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#verification-types">Verification Types</a></li>
<li class="toc-entry toc-h3"><a href="#verifier">Verifier</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#default-verification-types-and-methods">Default Verification Types and Methods</a>
<ul>
<li class="toc-entry toc-h3"><a href="#document-integrity-document_integrity">Document Integrity (DOCUMENT_INTEGRITY)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#openattestationhash">OpenAttestationHash</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#document-status-document_status">Document Status (DOCUMENT_STATUS)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#openattestationethereumdocumentstoreissued">OpenAttestationEthereumDocumentStoreIssued</a></li>
<li class="toc-entry toc-h4"><a href="#openattestationethereumdocumentstorerevoked">OpenAttestationEthereumDocumentStoreRevoked</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#issuer-identity-issuer_identity">Issuer Identity (ISSUER_IDENTITY)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#openattestationdnstxt">OpenAttestationDnsTxt</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#usage">Usage</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#decentralised-document-rendering">Decentralised Document Rendering</a>
<ul>
<li class="toc-entry toc-h2"><a href="#goal">Goal</a></li>
<li class="toc-entry toc-h2"><a href="#frame-to-frame-communication">Frame-to-Frame Communication</a>
<ul>
<li class="toc-entry toc-h3"><a href="#from-host-to-frame-actions">From host to frame actions</a>
<ul>
<li class="toc-entry toc-h4"><a href="#render_document">RENDER_DOCUMENT</a></li>
<li class="toc-entry toc-h4"><a href="#select_template">SELECT_TEMPLATE</a></li>
<li class="toc-entry toc-h4"><a href="#print">PRINT</a></li>
<li class="toc-entry toc-h4"><a href="#get_templates">GET_TEMPLATES</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#from-frame-to-host-actions">From frame to host actions</a>
<ul>
<li class="toc-entry toc-h3"><a href="#update_height">UPDATE_HEIGHT</a></li>
<li class="toc-entry toc-h3"><a href="#obfuscate">OBFUSCATE</a></li>
<li class="toc-entry toc-h3"><a href="#update_templates">UPDATE_TEMPLATES</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#selective-disclosure">Selective Disclosure</a>
<ul>
<li class="toc-entry toc-h2"><a href="#goal-1">Goal</a></li>
<li class="toc-entry toc-h2"><a href="#preparing-the-document">Preparing the document</a>
<ul>
<li class="toc-entry toc-h3"><a href="#salting-the-data">Salting the data</a></li>
<li class="toc-entry toc-h3"><a href="#computing-individual-hashes">Computing individual hashes</a></li>
<li class="toc-entry toc-h3"><a href="#computing-documents-targethash">Computing document’s targetHash</a></li>
<li class="toc-entry toc-h3"><a href="#assembling-the-oa-document">Assembling the OA document</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#obfuscating-a-value">Obfuscating a value</a></li>
<li class="toc-entry toc-h2"><a href="#check-integrity-of-the-document">Check integrity of the document</a></li>
<li class="toc-entry toc-h2"><a href="#implementation">Implementation</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#references">References</a></li>
<li class="toc-entry toc-h1"><a href="#annex">Annex</a>
<ul>
<li class="toc-entry toc-h2"><a href="#a-json-schema-definition">A: JSON Schema Definition</a></li>
<li class="toc-entry toc-h2"><a href="#intellectual-property">Intellectual Property</a></li>
<li class="toc-entry toc-h2"><a href="#license">License</a></li>
<li class="toc-entry toc-h2"><a href="#change-process">Change Process</a></li>
<li class="toc-entry toc-h2"><a href="#language">Language</a></li>
<li class="toc-entry toc-h2"><a href="#glossary">Glossary</a></li>
<li class="toc-entry toc-h2"><a href="#dependencies">Dependencies</a></li>
<li class="toc-entry toc-h2"><a href="#related-information">Related Information</a></li>
</ul>
</li>
</ul>
</div>
            <h1 id="abstract">Abstract</h1>

<p>This document describes the technical specifications for notarisation of trade documents using open-source solution leveraging on Distributed Ledger Technology (DLT). This allows end users receiving the document to verify the provenance and integrity of the document.</p>

<p>The use of such technology offers several advantages.</p>

<ul>
  <li>
    <p>There is no proprietary lock-in; solution will be open-source which lowers barriers of entry to market</p>
  </li>
  <li>
    <p>There is no centralised infrastructure (governance/sovereignty); thus, there would not be any single entity in charge of the verification/data that eliminates the trust concern of which authority will have all the trade information in trade world especially when cross-border trading is involved</p>
  </li>
  <li>
    <p>Elevates automated trade document processing; allows for any parties in the supply chain to issue trade documents, and for anyone to quickly check the validity of a digital trade documents. This will in time make trade facilitation easier and smoother for the whole supply chain workflow</p>
  </li>
  <li>
    <p>Connecting the disconnected world (digital standard); allowing isolated eco-systems to be interoperable</p>
  </li>
</ul>

<h1 id="introduction">Introduction</h1>

<p>Before digital transformation transpired, trade documents require a lot of administrative burden resulting in an increase in time and cost of manual verification. With the emergence of digital technologies in the trade world, it has changed the way we work and helped to improve operational efficiency across supply chains.</p>

<p>Trade has grown remarkably over the last century with the trade world having numerous isolated ecosystems. Such system isolations resulted in individual systems not being able to verify trade documents from other ecosystems.</p>

<p>Lack of trust in the data is another major contributing factor that hinders global trade facilitation and the move to true digitalization of the supply chain. Paperless initiatives are yet to be widely adopted. For example, in sea freight, Bill of Lading is still made up of three originals and require six copies and digitized formats are still unacceptable for many parties.<sup id="footnote1"><a href="#f1">[1]</a></sup></p>

<p>There has always been an inherent lack of trust between buyers, sellers, supply chain participants, agencies and governments. Due to this layer of trust, work processes such as document verification is still heavily reliant on the use of papers.<sup id="footnote2"><a href="#f2">[2]</a></sup></p>

<p>Current forms of digital document are neither tamper-proof nor have provenance, resulting in digitalised documents still falling back to the paper documents at some point of the supply chain flow. Thus, we need to have a solution that allows trade documents to be cryptographically trustworthy and can be verified independently.</p>

<p>A major cultural and paradigm shift in the trade world has taken shape since the introduction of Blockchain almost a decade ago. Blockchain, which is a form of DLT offers opportunities to increase reliability and security of trade transactions.<sup id="footnote2"><a href="#f2">[2]</a></sup></p>

<p>As we embark into the Blockchain to facilitate greater transparency, portability of information and greater operational efficiency, trade documents can now be notarised digitally and allowed tracing on the provenance and verification of digitally issued documents. This notarisation makes use of a framework to format data so that it can be fingerprinted, and then notarised on a trusted platform, such as the Ethereum blockchain.</p>

<h2 id="goals">Goals</h2>

<p>The following are features that would faciliate on the suggested notarisation method:</p>

<ul>
  <li>Standard wrapper for document (see JSON schema 3)</li>
  <li>Support multiple document types</li>
  <li>Verify issuer’s identity (provenance)</li>
  <li>Tamper-proof document integrity (integrity)</li>
  <li>Selective data disclosure (data obfuscation)</li>
  <li>Standard &amp; best-practices for storage &amp; transmission</li>
  <li>Support multiple backend (ETH/API/Private Blockchain)</li>
  <li>Compatible with W3C Verifiable Claims</li>
</ul>

<h2 id="use-cases">Use Cases</h2>

<p>Trade documentation plays a vital role in international trade as it facilitates the smooth flow of goods and payments thereof across national frontiers. There are many trade documents in which we can categorise them into 2 main groups:</p>
<ul>
  <li>Non-transferable documents</li>
  <li>Transferable documents</li>
</ul>

<p>A non-transferable documents belongs to one person and cannot legally be given to another person and used by them. An example is an air ticket or Certificate of Non-Manipulation (CNM).</p>

<p>As for transferable documents, it can be transferred by one person to another, passing to the transferee the rights of the original holder. Transferable documents typically include bills of lading, and warehouse receipts.</p>

<p>With numerous trade documents involved in international trade, document verification is an essential process as it verifies the identity of the document signer to prevent fraud, and checks for awareness and volition. Thus we need a solution that allows document verification to be executed digitally and safely.</p>

<p>We also note that there are a couple of methods to digitalise notarisation such as electronic-signature, electronic notarisation, webcam notarisation and etc. Electronic notarisation will be discussed further to prove the verification mechanisam in a decentralised manner in which both Domain Name Server (DNS) and Token Registry are 2 unique blockchain solutions that can demostrate document verification for Non-Transferable Documents and Transferable Documents respectively.</p>

<h3 id="domain-name-server-dns">Domain Name Server (DNS)</h3>

<p>DNS is the phonebook of the Internet, connecting web browsers with websites.
By allowing the DNS system to be used as an identity registry, we allow the domain name owners to claim ownership of a Document Store smart contract on the Blockchain.</p>

<p>The DNS system is a key part of Internet infrastructure, and is a decentralised system - this means that there is a low barrier to entry and does not have a single point of failure. It allows issuers to simply tie their issuance to their domain name, (e.g example.openattestation.com). When a user views a certificate issued under this model, they will see “Document issued by example.openattestation.com”.</p>

<h3 id="token-registry">Token Registry</h3>

<p>Token Registry supports the construct of assets which can have ownership assigned to them. This is supported using Blockchain smart contracts to keep track of the owner of a particular asset. This solution will faciliate the title transfer requirements for Transferable Documents.</p>

<h4 id="non-transferable-document">Non-transferable Document</h4>

<h5 id="certificate-of-non-manipulation">Certificate of Non-Manipulation</h5>

<p>A CNM, issued in the country of transit, provides documentary evidence that the goods have not been switched or modified during transit and that they retain the originating status of their country of export. Importers often use the certificate when transhipping goods.</p>

<p><img src="document_store.png" alt="docs" /></p>

<h6 id="preconditions">Preconditions</h6>
<ul>
  <li>The issuer has a domain name which is custom.example.com.</li>
  <li>The issuer has deployed a document store smart contract on Ethereum.</li>
</ul>

<h6 id="prove-ownership-of-document-store">Prove Ownership of Document Store</h6>
<ul>
  <li>Create TXT record to bind document store to domain.</li>
</ul>

<h6 id="prove-document-issuance">Prove Document Issuance</h6>
<ul>
  <li>Publish the merkle root of the document onto the document store.</li>
</ul>

<h6 id="verification">Verification</h6>
<ul>
  <li>Issuance Method
    <ul>
      <li>Check that merkle root of the document exists on the ‘Issued’ list on the document store.</li>
      <li>Check that the merkle root of the document does not exist on the revocation (‘Revoked’) list of the document store.</li>
    </ul>
  </li>
  <li>Integrity Method
    <ul>
      <li>Check that the document data’s hash is the ‘targetHash’;</li>
      <li>Check the targetHash resolves to the merkle root using the proof (if any);</li>
    </ul>
  </li>
  <li>Issuer Identity
    <ul>
      <li>Check that a TXT record exist on the domain claiming the ownership of the document store</li>
    </ul>
  </li>
</ul>

<h4 id="transferable-document">Transferable Document</h4>
<h5 id="bill-of-lading">Bill of Lading</h5>

<p>Bill of Lading allows the transmission of ownership of the goods through a simple endorsement.</p>

<p><img src="token_registry.png" alt="docs" /></p>

<h6 id="preconditions-1">Preconditions</h6>
<ul>
  <li>The issuer has a domain name which is custom.example.com.</li>
  <li>The issuer has deployed a token registry smart contract on Ethereum.</li>
</ul>

<h6 id="prove-ownership-of-token-registry">Prove Ownership of Token Registry</h6>
<ul>
  <li>Create TXT record to bind token registry to domain.</li>
</ul>

<h6 id="prove-document-issuance-1">Prove Document Issuance</h6>
<ul>
  <li>Assign an owner to the corresponding document’s target hash.</li>
</ul>

<h6 id="verification-1">Verification</h6>

<ul>
  <li>Issuance Method
    <ul>
      <li>Check that target hash of the document exists in the list of tokens in the token registry.</li>
    </ul>
  </li>
  <li>Integrity Method
    <ul>
      <li>Check that the document data’s hash is the ‘targetHash’.</li>
      <li>Check the targetHash resolves to the merkle root using the proof (if any).</li>
    </ul>
  </li>
  <li>Issuer Identity
    <ul>
      <li>Check that a TXT record exists on the domain claiming the ownership of the token registry.</li>
    </ul>
  </li>
</ul>

<h1 id="data-model">Data Model</h1>

<h2 id="json-schema">JSON Schema</h2>

<p>The document data model is defined using JSON Schema with the following definitions found in Annex A.</p>

<h2 id="json-schema-validator">JSON Schema Validator</h2>

<p>A useful online tool JSON Schema Validator that can help to validate whether the document data conforms to the schema: https://www.jsonschemavalidator.net/</p>

<p>Just paste the content of the schema document on the left panel and enter the document data on the right. The tool will instantly validate the document String/Object and notify any potential errors.</p>

<p>An example of a passing validation:</p>

<p><img src="json_success.png" alt="docs" /></p>

<p>An example of a failed validation:</p>

<p><img src="json_failed.png" alt="docs" /></p>

<h1 id="basic-concept">Basic Concept</h1>
<h2 id="verification-method">Verification Method</h2>

<p>The purpose of the verifier is to provide a generic verification method to verify OpenAttestation(OA) documents. The verifier will provide default verification methods conforming to the standard verification process proposed in OpenAttestation yet providing opportunities for it to be extended.</p>

<h3 id="overview-of-the-verification-methods">Overview of the verification methods</h3>

<p><img src="architecture.png" alt="docs" /></p>

<p>A verifier is made up of multiple <code class="highlighter-rouge">Verification Methods</code>. In the diagram above, <code class="highlighter-rouge">OpenAttestationDnsTxt, OpenAttestationEthereumDocumentStoreIssued</code> and <code class="highlighter-rouge">OpenAttestationHash</code> are examples of <code class="highlighter-rouge">Verification Methods</code> provided.</p>

<p>The role of a verification method is to verify the OA document is valid against specific criterias. Since there are many types and versions of OA document, not all test should run against all types of OA document. For that reason, a <code class="highlighter-rouge">test</code> method is also defined to test if a method should run against a document. If the method is incompatible with the document type, it should skip the method.</p>

<p>As a result, a verification method should implement 3 abstract methods: <code class="highlighter-rouge">verify, test and skip</code>.</p>

<p>The verification method should return a <code class="highlighter-rouge">VerificationFragment</code> which states the status of the verification. The status key can have the following values:</p>

<ul>
  <li><code class="highlighter-rouge">VALID</code>: when the verification is successful</li>
  <li><code class="highlighter-rouge">INVALID</code>: when the verification is unsuccessful</li>
  <li><code class="highlighter-rouge">ERROR</code>: when an unexpected error is met</li>
  <li><code class="highlighter-rouge">SKIPPED</code>: when the verification was skipped by the manager</li>
</ul>

<h4 id="testdocument-document-boolean">test(document: Document): boolean</h4>
<p>This function takes in an OA document and returns a boolean result that determines if this verification method is meant to be ran against the document.</p>

<p>In the case that the test passes, we should run the <code class="highlighter-rouge">verify</code> function. Otherwise, the <code class="highlighter-rouge">skip</code> function should be ran.</p>

<h4 id="skip-verificationfragment">skip(): VerificationFragment</h4>
<p>This function should be ran when the verification method is skipped for the given OA document. It will return the skipped <code class="highlighter-rouge">VerificationFragment</code> for the test.</p>

<p>An example of <code class="highlighter-rouge">VerificationFragment</code> that skips the DNS-TXT verification:
{</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OpenAttestationDnsTxt"</span><span class="err">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISSUER_IDENTITY"</span><span class="err">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SKIPPED"</span><span class="err">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Document issuers doesn't have </span><span class="se">\"</span><span class="s2">documentStore</span><span class="se">\"</span><span class="s2"> or </span><span class="se">\"</span><span class="s2">token</span><span class="se">\"</span><span class="s2"> property"</span><span class="w">
  
</span></code></pre></div></div>
<p>}</p>

<h4 id="verifydocument-document-verificationfragment">verify(document: Document): VerificationFragment</h4>

<p>This function should be ran when the test passes. Running this function will execute the necessary computation to determine if the document passes the verification method.</p>

<p>An example <code class="highlighter-rouge">VerificationFragment</code> of a passing test:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OpenAttestationEthereumDocumentStoreIssued"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCUMENT_STATUS"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VALID"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x007d40224f6562461633ccfbaffd359ebb2fc9ba"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"issued"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"issuedOnAll"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>An example <code class="highlighter-rouge">VerificationFragment</code> of a failed test:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OpenAttestationEthereumDocumentStoreIssued"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCUMENT_STATUS"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INVALID"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Certificate has not been issued"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x20bc9C354A18C8178A713B9BcCFFaC2152b53990"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"call exception (address=</span><span class="se">\"</span><span class="s2">0x20bc9C354A18C8178A713B9BcCFFaC2152b53990</span><span class="se">\"</span><span class="s2">, method=</span><span class="se">\"</span><span class="s2">isIssued(bytes32)</span><span class="se">\"</span><span class="s2">, args=[</span><span class="se">\"</span><span class="s2">0x85df2b4e905a82cf10c317df8f4b659b5cf38cc12bd5fbaffba5fc901ef0011b</span><span class="se">\"</span><span class="s2">], version=4.0.40)"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"issued"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"issuedOnAll"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="verification-types">Verification Types</h3>

<p>A <code class="highlighter-rouge">Verification Type</code> is a type label to a verification method. It specifies what type of verification the method is performing. The diagram above shows the 3 default verification types: <code class="highlighter-rouge">ISSUER_IDENTITY</code>, <code class="highlighter-rouge">DOCUMENT_INTEGRITY</code> and <code class="highlighter-rouge">DOCUMENT_STATUS</code>.</p>

<p>For the validity of the verification type to be true, the requirements must be met:</p>

<ol>
  <li>At least one method in that type should return <code class="highlighter-rouge">VALID</code> as the status.</li>
  <li>All methods in the type should return either <code class="highlighter-rouge">VALID</code> or <code class="highlighter-rouge">SKIPPED</code> as the status.</li>
</ol>

<h3 id="verifier">Verifier</h3>

<p>The verifier is a function used to verify any OpenAttestation document. It returns a set of <code class="highlighter-rouge">VerificationFragment</code> from the different verification methods.</p>

<p>From the <code class="highlighter-rouge">VerificationFragments</code> we can then determine if the OA document is valid. The OA document is valid when all <code class="highlighter-rouge">Verification Types</code> has valid statuses.</p>

<h2 id="default-verification-types-and-methods">Default Verification Types and Methods</h2>

<h3 id="document-integrity-document_integrity">Document Integrity (DOCUMENT_INTEGRITY)</h3>

<p>The <code class="highlighter-rouge">DOCUMENT_INTEGRITY</code> type of verification methods ensure that the content of the issued document has not been modified since the document has been issued, with exception of data which has been removed using built-in obfuscation mechanism.</p>

<h4 id="openattestationhash">OpenAttestationHash</h4>

<p>The <code class="highlighter-rouge">OpenAttestationHash</code> method checks the integrity of the document using the <code class="highlighter-rouge">OpenAttestationSignature2018</code> method by digesting the content of the OA document and comparing it with the document’s <code class="highlighter-rouge">targetHash</code>.</p>

<p>In addition, if the <code class="highlighter-rouge">targetHash</code> does not match the <code class="highlighter-rouge">merkleRoot</code> of the document, the function also checks that the <code class="highlighter-rouge">targetHash</code> resolves to the <code class="highlighter-rouge">merkleRoot</code> using the given <code class="highlighter-rouge">proofs</code>.</p>

<h3 id="document-status-document_status">Document Status (DOCUMENT_STATUS)</h3>

<p>The <code class="highlighter-rouge">DOCUMENT_STATUS</code> type of verification methods checks that the document has been issued and that it’s issuance status is in good standing. Methods of these types generally verifies the issuance status against a record maintained externally, ie Records on a Blockchain or API endpoints.</p>

<h4 id="openattestationethereumdocumentstoreissued">OpenAttestationEthereumDocumentStoreIssued</h4>

<p>The <code class="highlighter-rouge">OpenAttestationEthereumDocumentStoreIssued</code> checks the issuance status of the document using <code class="highlighter-rouge">OpenAttestationSignature2018</code> with <code class="highlighter-rouge">DOCUMENT_STORE</code> or <code class="highlighter-rouge">TOKEN_REGISTRY</code> methods.</p>

<p>Signature of OA Document using this method:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OpenAttestationSignature2018"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCUMENT_STORE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Such document uses a smart contract to store the issuance status of the document.</p>

<p>In the case of <code class="highlighter-rouge">DOCUMENT_STORE</code> smart contract, the check calls the method <code class="highlighter-rouge">isIssued(merkleRoot)</code> implemented on the Ethereum smart contract. It returns a valid <code class="highlighter-rouge">VerificationFragment</code> if the merkle root of the document has been marked as issued.</p>

<p>In the case of <code class="highlighter-rouge">TOKEN_REGISTRY</code> smart contract, the check calls the method <code class="highlighter-rouge">ownerOf(targetHash)</code> implemented on the Ethereum smart contract. It returns a valid <code class="highlighter-rouge">VerificationFragment</code> if the owner of the document is non-zero.</p>

<h4 id="openattestationethereumdocumentstorerevoked">OpenAttestationEthereumDocumentStoreRevoked</h4>

<p>The <code class="highlighter-rouge">OpenAttestationEthereumDocumentStoreRevoked</code> checks the revocation status of the document using <code class="highlighter-rouge">OpenAttestationSignature2018</code> with <code class="highlighter-rouge">DOCUMENT_STORE</code> or <code class="highlighter-rouge">TOKEN_REGISTRY</code> methods, similar to <code class="highlighter-rouge">OpenAttestationEthereumDocumentStoreIssued</code>.</p>

<p>In the case of <code class="highlighter-rouge">DOCUMENT_STORE</code> smart contract, the check calls the method <code class="highlighter-rouge">isRevoked(merkleRoot)</code> implemented on the Ethereum smart contract. It returns a valid <code class="highlighter-rouge">VerificationFragment</code> if the merkle root of the document has not been marked as revoked.</p>

<h3 id="issuer-identity-issuer_identity">Issuer Identity (ISSUER_IDENTITY)</h3>

<p>The <code class="highlighter-rouge">ISSUER_IDENTITY</code> type of verification methods checks and return the identity of the issuer. Methods of these types generally verify the identity of the issuer against a decentralised identity provider (ie DID, DNS, etc) or some centrally managed identity registry (ie Singapore’s OpenCerts Registry, Citizen Identity Registry, Business Identity Registry, etc).</p>

<h4 id="openattestationdnstxt">OpenAttestationDnsTxt</h4>

<p>The <code class="highlighter-rouge">OpenAttestationDnsTxt</code> method checks the identity of a document issuer using the <code class="highlighter-rouge">DNS-TXT</code> identity proof mechanism.</p>

<p>The sample provided below shows a document which claims that <code class="highlighter-rouge">openattestation.com</code> is the owner of the smart contract <code class="highlighter-rouge">0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d</code>, which in turn issued the said document:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://openattestation.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Open Attestation"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"identityProof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DNS-TXT"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openattestation.com"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OpenAttestationSignature2018"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCUMENT_STORE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The method checks against the DNS record of the domain to confirm the claimed relationship. A sample TXT record on <code class="highlighter-rouge">openattestation.com</code> to prove ownership of the contract <code class="highlighter-rouge">0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d</code> on Ethereum Ropsten network is provided below:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openatts net=ethereum netId=3 addr=0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d
</code></pre></div></div>

<p>Upon confirming that the matching DNS TXT record on the domain, the verification method returns a valid <code class="highlighter-rouge">VerificationFragment</code> as the result.</p>

<p>In depth discussion of DNS-TXT method is described <a href="https://blog.gds-gov.tech/opencerts-2-0-decentralised-issuer-identity-verification-fb7e2cae8295">in this blog post</a></p>

<h2 id="usage">Usage</h2>

<p>To use the default verifier:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nb">document</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">OA-Document</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">verificationFragments</span> <span class="o">=</span> <span class="nx">verify</span><span class="p">(</span><span class="nb">document</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">verified</span> <span class="o">=</span> <span class="nx">isVerified</span><span class="p">(</span><span class="nx">verificationFragments</span><span class="p">);</span>
</code></pre></div></div>

<p>To extend the verifier with a custom name registry:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nb">document</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">OA-Document-With-Custom-Identity-Proof</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">customIdentityRegistry</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Custom-Verification-Method</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">verificationFragments</span> <span class="o">=</span> <span class="nx">verificationBuilder</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="p">[</span>
  <span class="p">...</span><span class="nx">defaultVerifiers</span><span class="p">,</span>
  <span class="nx">customIdentityRegistry</span>
<span class="p">]);</span>
<span class="kd">const</span> <span class="nx">verified</span> <span class="o">=</span> <span class="nx">isVerified</span><span class="p">(</span><span class="nx">verificationFragments</span><span class="p">);</span>
</code></pre></div></div>

<h1 id="decentralised-document-rendering">Decentralised Document Rendering</h1>

<h2 id="goal">Goal</h2>

<p><img src="decentralised_rendered_overview.png" alt="docs" /></p>

<p>The purpose of the decentralised document renderer is to allow OpenAttestation (OA) document issuers to style their documents without code change to the different implementations of the document viewer. It does so by embedding the website specified by the document issuers as an iframe or webview (for mobile apps) and sending the content of the OA document into the iframe.</p>

<h2 id="frame-to-frame-communication">Frame-to-Frame Communication</h2>

<p><img src="decentralised_rendered_api.png" alt="docs" /></p>

<p>Since the decentralised renderer is rendering a document dynamically, <code class="highlighter-rouge">Actions</code> are used to two-way communication between the parent frame (document-renderer.com) and the child frame (renderer.example.com).</p>

<p>All actions follow the same structure and are composed of type and payload</p>

<ul>
  <li><code class="highlighter-rouge">type</code> indicates the kind of action executed, for instance, RENDER_DOCUMENT to render a document. The type of action is mandatory</li>
  <li><code class="highlighter-rouge">payload</code> indicates optional data associated with the type, for instance, the content of the document to render.</li>
</ul>

<p>Examples of actions used:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">renderDocumentAction</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">RENDER_DOCUMENT</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">payload</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">document</span><span class="p">:</span> <span class="nx">documentToRender</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">printAction</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PRINT</span><span class="dl">"</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="from-host-to-frame-actions">From host to frame actions</h3>

<p>The following list of actions are made for the host to communicate to the iframe (and thus must be handled by application embed in the iframe):</p>

<h4 id="render_document">RENDER_DOCUMENT</h4>

<p>This action sends the document data to the child frame to be rendered.</p>

<p>The payload is an object with 2 properties:</p>

<ul>
  <li>document: (mandatory) document data as returned by getData method from @govtechsg/open-attestation</li>
  <li>rawDocument: (optional) Open Attestation document</li>
</ul>

<p>Example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">RENDER_DOCUMENT</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">payload</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">document</span><span class="p">:</span> <span class="nx">getData</span><span class="p">(</span><span class="nb">document</span><span class="p">),</span>
    <span class="na">rawDocument</span><span class="p">:</span> <span class="nb">document</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="select_template">SELECT_TEMPLATE</h4>

<p>This action selects a template amongst the one provided by the decentralized renderer (A renderer may provide 1 to many different templates to display a document).</p>

<p>The payload is the tab id to display.</p>

<p>Example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SELECT_TEMPLATE</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">payload</span><span class="p">:</span> <span class="dl">"</span><span class="s2">CUSTOM_TEMPLATE</span><span class="dl">"</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="print">PRINT</h4>

<p>This action request for the template to process the print action by the browser.</p>

<p>Example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="p">{</span>
<span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PRINT</span><span class="dl">"</span>
<span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PRINT</span><span class="dl">"</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="get_templates">GET_TEMPLATES</h4>

<p>This action returns the list of template tabs available on the document.</p>

<p>The payload is the document data as returned by <code class="highlighter-rouge">getData</code> method from @govtechsg/open-attestation</p>

<p>Example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GET_TEMPLATES</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">payload</span><span class="p">:</span> <span class="nx">getData</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="from-frame-to-host-actions">From frame to host actions</h2>

<p>The following list of actions are made for iframe to communicate to the host (and thus must be handled by application embedding the iframe):</p>

<h3 id="update_height">UPDATE_HEIGHT</h3>

<p>This action provides the full content height of the iframe so that the host can adapt the automatically the size of the embedded iframe.</p>

<p>The payload is the full content height of the child iframe.</p>

<p>Example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">UPDATE_HEIGHT</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">payload</span><span class="p">:</span> <span class="mi">150</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="obfuscate">OBFUSCATE</h3>

<p>This action provides the name of a field on the document to obfuscate. The value must follow path property.</p>

<p>The payload is the path to the field to be obfuscated.</p>

<p>Example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">OBFUSCATE</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">payload</span><span class="p">:</span> <span class="dl">"</span><span class="s2">a[0].b.c</span><span class="dl">"</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="update_templates">UPDATE_TEMPLATES</h3>

<p>This action provides the list of templates that can be used to render a document. This is usually the response to the <code class="highlighter-rouge">GET_TEMPLATES</code> action.</p>

<p>Example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">action</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">UPDATE_TEMPLATES</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">payload</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">certificate</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">label</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Certificate</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">transcript</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">label</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Transcript</span><span class="dl">"</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>
</code></pre></div></div>
<h1 id="selective-disclosure">Selective Disclosure</h1>

<h2 id="goal-1">Goal</h2>

<p>Selective disclosure allows for the holder of OA documents to present subsets of the document to be verified. It does so by allowing users to obfuscated data fields without compromising the integrity of the document.</p>

<p>To achieve this, we compute a hash over individually hashed and salted key-value pairs. During obfuscation, we will hash the salted key-value pair and store the hash in another location of the document.</p>

<p><img src="selective_disclosure_overview.png" alt="docs" /></p>

<p>During integrity verification, we will recompute the hash of the document by:</p>

<ol>
  <li>Nomalising the document into individual key-value pairs</li>
  <li>Hashing each of the individual key-value pairs</li>
  <li>Compute the target hash of the document</li>
</ol>

<p>In this document, we will describe the steps to:</p>

<ol>
  <li>Prepare an OA document</li>
  <li>Obfuscate a value on an issued OA document</li>
  <li>Check the integrity of an issued OA document</li>
</ol>

<h2 id="preparing-the-document">Preparing the document</h2>

<h3 id="salting-the-data">Salting the data</h3>

<p>To generate an OA document, through a process known as <code class="highlighter-rouge">document wrapping</code>, each value is converted from its primitive type to a string with a UUID, the data type and the original value.</p>

<p>The UUID prevents rainbow table attacks on the value after it has been obfuscated and the type will help disambiguate the original data type.</p>

<p>Sample raw data input:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"document identifier"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"validFrom"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2010-01-01T19:23:24Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"document owner name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"any"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EMBEDDED_RENDERER"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://some.example.com"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://some.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DEMO STORE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"identityProof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DNS-TXT"</span><span class="p">,</span><span class="w"> </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tradetrust.io"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OpenAttestationSignature2018"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TOKEN_REGISTRY"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key3"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"value3.1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value3.2"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"key4"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key41"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value4.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"key42"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value4.2"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Output after salt:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2cc91073-3863-4db6-9f1a-b68665088caa:string:document identifier"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"validFrom"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca425b5c-d25d-4a36-b0f7-e368fbbaf75d:string:2010-01-01T19:23:24Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c6864a9b-0367-4b8b-8cc5-f59cb6331f3d:string:document owner name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"36a95964-fbe9-4c6d-ab6a-a5247c07f105:string:any"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"45c266d0-3efe-4841-893c-96723cd7ddb5:string:EMBEDDED_RENDERER"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bbec168c-b9c3-4fb3-aa6f-3d1a1017f1e9:string:http://some.example.com"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42b6991b-e4b5-444b-aba7-7ce97bbe8441:string:http://some.example.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"da3fa13d-b0a9-4357-bd4c-4f3941304225:string:DEMO STORE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"identityProof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e2039c5b-6cab-4679-9150-7266e34371a4:string:DNS-TXT"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"684bb30d-a59e-4cc3-a8ed-44e6b72579d9:string:tradetrust.io"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bc64159e-90f3-4f0c-99bb-43818ff402e5:string:OpenAttestationSignature2018"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"edd73480-3043-4cdc-aefd-f4ee21fc6a7f:string:0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6ae5877f-be97-47df-99f7-7464a5ca1cde:string:TOKEN_REGISTRY"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c1ba53a6-68b8-421e-ac80-7d4b71ca8e52:string:value1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0356d74e-10cd-4cc1-b1ba-eab23f8bea3d:string:value2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key3"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"44faf2a4-d16f-4945-8784-d2b8a088edc5:string:value3.1"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"18eaf71f-3b4a-4064-b8f5-79092c2e04aa:string:value3.2"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"key4"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"key41"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7e3b72f8-e521-4892-a26c-b56d3e2ab5cf:string:value4.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key42"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c4f96a54-dda6-4fe2-9f49-bc77e8e19d02:string:value4.2"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="computing-individual-hashes">Computing individual hashes</h3>

<p>After the individual values have been salted, the entire data object is flattened, while preserving the hierarchical structure of the data within the individual keys.</p>

<p>In our implementation the library <a href="https://www.npmjs.com/package/flatley">flatley</a> is used to flatten the object and <a href="https://www.npmjs.com/package/js-sha3">js-sha3</a> is used to compute the <code class="highlighter-rouge">keccak256</code> hash.</p>

<p>Output after flattening:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2cc91073-3863-4db6-9f1a-b68665088caa:string:document identifier"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"validFrom"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca425b5c-d25d-4a36-b0f7-e368fbbaf75d:string:2010-01-01T19:23:24Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c6864a9b-0367-4b8b-8cc5-f59cb6331f3d:string:document owner name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"template.name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"36a95964-fbe9-4c6d-ab6a-a5247c07f105:string:any"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"template.type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"45c266d0-3efe-4841-893c-96723cd7ddb5:string:EMBEDDED_RENDERER"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"template.url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bbec168c-b9c3-4fb3-aa6f-3d1a1017f1e9:string:http://some.example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"issuer.id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42b6991b-e4b5-444b-aba7-7ce97bbe8441:string:http://some.example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"issuer.name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"da3fa13d-b0a9-4357-bd4c-4f3941304225:string:DEMO STORE"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"issuer.identityProof.type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e2039c5b-6cab-4679-9150-7266e34371a4:string:DNS-TXT"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"issuer.identityProof.location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"684bb30d-a59e-4cc3-a8ed-44e6b72579d9:string:tradetrust.io"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"proof.type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bc64159e-90f3-4f0c-99bb-43818ff402e5:string:OpenAttestationSignature2018"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"proof.value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"edd73480-3043-4cdc-aefd-f4ee21fc6a7f:string:0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"proof.method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6ae5877f-be97-47df-99f7-7464a5ca1cde:string:TOKEN_REGISTRY"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c1ba53a6-68b8-421e-ac80-7d4b71ca8e52:string:value1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0356d74e-10cd-4cc1-b1ba-eab23f8bea3d:string:value2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key3.0"</span><span class="p">:</span><span class="w"> </span><span class="s2">"44faf2a4-d16f-4945-8784-d2b8a088edc5:string:value3.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key3.1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"18eaf71f-3b4a-4064-b8f5-79092c2e04aa:string:value3.2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key4.key41"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7e3b72f8-e521-4892-a26c-b56d3e2ab5cf:string:value4.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key4.key42"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c4f96a54-dda6-4fe2-9f49-bc77e8e19d02:string:value4.2"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Once the data object has been salted and flattened, each key-value pair will be hashed.</p>

<p>In the example above, we will apply the <code class="highlighter-rouge">keccak256</code> hash on the object <code class="highlighter-rouge">{"key4.key41":"7e3b72f8-e521-4892-a26c-b56d3e2ab5cf:string:value4.1"}</code> which will yield <code class="highlighter-rouge">c3edad333f0829b92a82cd3c09b7795b0f00f07dfbbfc5ff8779272d1eaba3a8</code>.</p>

<p>Once this function has been applied to all the keys, the output hashes will be sorted and stored in an array.</p>

<p>Output after all hashing individual keys (sorted):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="s2">"1b61eaed9b46a53c530ca7cbe1ed54621e9478b86efb445a932f3cb38d6a97da"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"28e72c3815a932b137f3dc0d9d9fa101d6d7477793acf5adcb5f34f0901c3811"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"2a73ae2d0e942748f632130c530e4d3eb0e91dcf8e560c52586ecf2cf84daefd"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"32559f7f05f498d2ffe89345a379fa6619cd20466474386b26ac8b328b28e03e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"5464490fed778a23505a0da8cb8ffa8ebf47b85fa221f544d0757a96e5be315d"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"5c51bab9dda34200e24a5bf46ce39a82561515239f869d444cd7b458bb986483"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"6b19136bf4ff28c270b913786c329c6c1186857a5fb5b9897bc4bdf00f95041d"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"6ec1924f5f25afe82b01ed108775ab27125b0e7277687a1c1acef27ce34cb189"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"87da7c3a74118736144688664ffa621e7e39837c23719a0b4c88ee0fa0b08357"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"88c680973e4c58095b222aabfe2d62ffe8bf3a9dacccb6cea112805abdb2d475"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"91788b66ce30099e244d180bc18ce16b98de48598cd2ebf9f1cc7c508dc1b65e"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"9e029d96b11e4f4e4a37cb3bf03bf3af854b8ea059686945072f02c215e0aba6"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"a0b0a1e5992ad724ce101921001d9de2ff08a64c65d9e92b47142eb76fa03618"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"c04833e08f6a0d17cb8388db75dec3b07c603be118a1303f68332ae7eef26db5"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"c3edad333f0829b92a82cd3c09b7795b0f00f07dfbbfc5ff8779272d1eaba3a8"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"c6daa8acbd7b7591d6ea0055a6de3827b953ea3e295c024fc31c167cac1f112d"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"d8b26580983759e8cad2bcfd10dffdf375cd49b1e5d7b4424d7698216b683218"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"e3494dd41622c560a2df8cf9051f75a27ef651c46826e3eef6382187825794d5"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"f29d9f500d3843f547158fcd8b69b67406ad492621d9702a7903062f86ef97b0"</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h3 id="computing-documents-targethash">Computing document’s targetHash</h3>

<p>Finally, with the array of sorted hashes, <code class="highlighter-rouge">keccak256</code> is applied again on the stringified array to obtain the <code class="highlighter-rouge">targetHash</code> of the document.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">keccak256</span><span class="p">(</span>
  <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span>
    <span class="dl">"</span><span class="s2">1b61eaed9b46a53c530ca7cbe1ed54621e9478b86efb445a932f3cb38d6a97da</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">28e72c3815a932b137f3dc0d9d9fa101d6d7477793acf5adcb5f34f0901c3811</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">2a73ae2d0e942748f632130c530e4d3eb0e91dcf8e560c52586ecf2cf84daefd</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">32559f7f05f498d2ffe89345a379fa6619cd20466474386b26ac8b328b28e03e</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">5464490fed778a23505a0da8cb8ffa8ebf47b85fa221f544d0757a96e5be315d</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">5c51bab9dda34200e24a5bf46ce39a82561515239f869d444cd7b458bb986483</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">6b19136bf4ff28c270b913786c329c6c1186857a5fb5b9897bc4bdf00f95041d</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">6ec1924f5f25afe82b01ed108775ab27125b0e7277687a1c1acef27ce34cb189</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">87da7c3a74118736144688664ffa621e7e39837c23719a0b4c88ee0fa0b08357</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">88c680973e4c58095b222aabfe2d62ffe8bf3a9dacccb6cea112805abdb2d475</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">91788b66ce30099e244d180bc18ce16b98de48598cd2ebf9f1cc7c508dc1b65e</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">9e029d96b11e4f4e4a37cb3bf03bf3af854b8ea059686945072f02c215e0aba6</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">a0b0a1e5992ad724ce101921001d9de2ff08a64c65d9e92b47142eb76fa03618</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">c04833e08f6a0d17cb8388db75dec3b07c603be118a1303f68332ae7eef26db5</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">c3edad333f0829b92a82cd3c09b7795b0f00f07dfbbfc5ff8779272d1eaba3a8</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">c6daa8acbd7b7591d6ea0055a6de3827b953ea3e295c024fc31c167cac1f112d</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">d8b26580983759e8cad2bcfd10dffdf375cd49b1e5d7b4424d7698216b683218</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">e3494dd41622c560a2df8cf9051f75a27ef651c46826e3eef6382187825794d5</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">f29d9f500d3843f547158fcd8b69b67406ad492621d9702a7903062f86ef97b0</span><span class="dl">"</span>
  <span class="p">])</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Result:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"51d6b872aae578d6a4b7decd4370f50b73b5729d8357f3057e240c10bae64ab2"</span><span class="w">
</span></code></pre></div></div>

<h3 id="assembling-the-oa-document">Assembling the OA document</h3>

<p>Once the <code class="highlighter-rouge">targetHash</code> of the document is calculated, it can be appended to the document under the <code class="highlighter-rouge">signature</code> object.</p>

<p>Example of wrapped OA Document:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"open-attestation/3.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2cc91073-3863-4db6-9f1a-b68665088caa:string:document identifier"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"validFrom"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca425b5c-d25d-4a36-b0f7-e368fbbaf75d:string:2010-01-01T19:23:24Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c6864a9b-0367-4b8b-8cc5-f59cb6331f3d:string:document owner name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"36a95964-fbe9-4c6d-ab6a-a5247c07f105:string:any"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"45c266d0-3efe-4841-893c-96723cd7ddb5:string:EMBEDDED_RENDERER"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bbec168c-b9c3-4fb3-aa6f-3d1a1017f1e9:string:http://some.example.com"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42b6991b-e4b5-444b-aba7-7ce97bbe8441:string:http://some.example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"da3fa13d-b0a9-4357-bd4c-4f3941304225:string:DEMO STORE"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"identityProof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e2039c5b-6cab-4679-9150-7266e34371a4:string:DNS-TXT"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"684bb30d-a59e-4cc3-a8ed-44e6b72579d9:string:tradetrust.io"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bc64159e-90f3-4f0c-99bb-43818ff402e5:string:OpenAttestationSignature2018"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"edd73480-3043-4cdc-aefd-f4ee21fc6a7f:string:0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6ae5877f-be97-47df-99f7-7464a5ca1cde:string:TOKEN_REGISTRY"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c1ba53a6-68b8-421e-ac80-7d4b71ca8e52:string:value1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0356d74e-10cd-4cc1-b1ba-eab23f8bea3d:string:value2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key3"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"44faf2a4-d16f-4945-8784-d2b8a088edc5:string:value3.1"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"18eaf71f-3b4a-4064-b8f5-79092c2e04aa:string:value3.2"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"key4"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"key41"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7e3b72f8-e521-4892-a26c-b56d3e2ab5cf:string:value4.1"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"key42"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c4f96a54-dda6-4fe2-9f49-bc77e8e19d02:string:value4.2"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"privacy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"obfuscatedData"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"signature"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SHA3MerkleProof"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"targetHash"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51d6b872aae578d6a4b7decd4370f50b73b5729d8357f3057e240c10bae64ab2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"merkleRoot"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51d6b872aae578d6a4b7decd4370f50b73b5729d8357f3057e240c10bae64ab2"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="obfuscating-a-value">Obfuscating a value</h2>

<p>To obfuscate a value in the OA document, one simply hash the key-value pair with <code class="highlighter-rouge">keccak256</code> and store the resulting hash in <code class="highlighter-rouge">privacy.obfuscatedData</code>. This method can be used to obfuscate multiple key-value pairs in the document data file.</p>

<p>For example to obfuscated <code class="highlighter-rouge">key4.key41</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">keccak256</span><span class="p">(</span>
  <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
    <span class="dl">"</span><span class="s2">key4.key41</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">7e3b72f8-e521-4892-a26c-b56d3e2ab5cf:string:value4.1</span><span class="dl">"</span>
  <span class="p">})</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Resulting hash:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c3edad333f0829b92a82cd3c09b7795b0f00f07dfbbfc5ff8779272d1eaba3a8
</code></pre></div></div>

<p>This hash will then be appended to the original OA document and the object that has been obfuscated will be removed:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"open-attestation/3.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2cc91073-3863-4db6-9f1a-b68665088caa:string:document identifier"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"validFrom"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ca425b5c-d25d-4a36-b0f7-e368fbbaf75d:string:2010-01-01T19:23:24Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c6864a9b-0367-4b8b-8cc5-f59cb6331f3d:string:document owner name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"36a95964-fbe9-4c6d-ab6a-a5247c07f105:string:any"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"45c266d0-3efe-4841-893c-96723cd7ddb5:string:EMBEDDED_RENDERER"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bbec168c-b9c3-4fb3-aa6f-3d1a1017f1e9:string:http://some.example.com"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42b6991b-e4b5-444b-aba7-7ce97bbe8441:string:http://some.example.com"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"da3fa13d-b0a9-4357-bd4c-4f3941304225:string:DEMO STORE"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"identityProof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e2039c5b-6cab-4679-9150-7266e34371a4:string:DNS-TXT"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="s2">"684bb30d-a59e-4cc3-a8ed-44e6b72579d9:string:tradetrust.io"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bc64159e-90f3-4f0c-99bb-43818ff402e5:string:OpenAttestationSignature2018"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"edd73480-3043-4cdc-aefd-f4ee21fc6a7f:string:0x9178F546D3FF57D7A6352bD61B80cCCD46199C2d"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6ae5877f-be97-47df-99f7-7464a5ca1cde:string:TOKEN_REGISTRY"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"key1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c1ba53a6-68b8-421e-ac80-7d4b71ca8e52:string:value1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0356d74e-10cd-4cc1-b1ba-eab23f8bea3d:string:value2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key3"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"44faf2a4-d16f-4945-8784-d2b8a088edc5:string:value3.1"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"18eaf71f-3b4a-4064-b8f5-79092c2e04aa:string:value3.2"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"key4"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key42"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c4f96a54-dda6-4fe2-9f49-bc77e8e19d02:string:value4.2"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"privacy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"obfuscatedData"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"c3edad333f0829b92a82cd3c09b7795b0f00f07dfbbfc5ff8779272d1eaba3a8"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"signature"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SHA3MerkleProof"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"targetHash"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51d6b872aae578d6a4b7decd4370f50b73b5729d8357f3057e240c10bae64ab2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"merkleRoot"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51d6b872aae578d6a4b7decd4370f50b73b5729d8357f3057e240c10bae64ab2"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="check-integrity-of-the-document">Check integrity of the document</h2>

<p>To check the integrity of the document, we simply:</p>

<ol>
  <li>Flatten the data object</li>
  <li>Hash individual key-value pairs</li>
  <li>Append and sort the hash from (2) with the hashes from <code class="highlighter-rouge">privacy.obfuscatedData</code></li>
  <li>Compute the keccak256 hash for the results from (3)</li>
  <li>Check that the resulting hash from (4) matches the <code class="highlighter-rouge">targetHash</code></li>
</ol>

<h2 id="implementation">Implementation</h2>

<p><a href="https://github.com/Open-Attestation/open-attestation">OpenAttestation</a></p>

<h1 id="references">References</h1>

<p>OA Schema V3 - https://github.com/Open-Attestation/open-attestation/blob/56231b83b6bd0b6bb164bdd830fc02886b578ec1/src/schema/3.0/schema.json</p>

<p>Verifier Manager Model - https://github.com/Open-Attestation/oa-verify/pull/74</p>

<p>DNS Identity Proof - https://blog.gds-gov.tech/opencerts-2-0-decentralised-issuer-identity-verification-fb7e2cae8295</p>

<p>W3C VC - https://www.w3.org/TR/vc-data-model/</p>

<p><sup id="f1">[1]</sup> 
<a href="https://www.unece.org/fileadmin/DAM/cefact/GuidanceMaterials/WhitePaperDataPipeline_Eng.pdf">UN/CEFACT White Paper on Data Pipeline</a> 
<a href="#footnote1">↩</a></p>

<p><sup id="f2">[2]</sup> 
<a href="https://www.unece.org/tradewelcome/un-centre-for-trade-facilitation-and-e-business-uncefact/outputs/guidance-material/doc.html">UN/CEFACT White Paper on Technical Application of Blockchain to UN/CEFACT deliverables</a> 
<a href="#footnote2">↩</a></p>

<h1 id="annex">Annex</h1>

<h2 id="a-json-schema-definition">A: JSON Schema Definition</h2>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="p">{</span><span class="w">
 </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Open Attestation Schema v3"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"$id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"open-attestation/3.0"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://json-schema.org/draft-07/schema#"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">



 </span><span class="nl">"definitions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"URI when dereferenced, results in a document containing machine-readable information about the issuer that can be used to verify the information expressed in the credential. More information in https://www.w3.org/TR/vc-data-model/#issuer"</span><span class="w">
       </span><span class="p">},</span><span class="w">
       </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Issuer's name"</span><span class="w">
       </span><span class="p">},</span><span class="w">
       </span><span class="nl">"identityProof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
           </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
             </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
             </span><span class="nl">"enum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"DNS-TXT"</span><span class="p">]</span><span class="w">
           </span><span class="p">},</span><span class="w">
           </span><span class="nl">"location"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
             </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
             </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Url of the website referencing to document store"</span><span class="w">
           </span><span class="p">}</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
         </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"location"</span><span class="p">]</span><span class="w">
       </span><span class="p">}</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"identityProof"</span><span class="p">],</span><span class="w">
     </span><span class="nl">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
   </span><span class="p">}</span><span class="w">
 </span><span class="p">},</span><span class="w">



 </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
       </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"List of URI to determine the terminology used in the verifiable credential as explained by https://www.w3.org/TR/vc-data-model/#contexts"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"URI to the subject of the credential as explained by https://www.w3.org/TR/vc-data-model/#credential-subject"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"reference"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Internal reference, usually serial number, of this document"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Human readable name of the credential"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Specific verifiable credential type as explained by https://www.w3.org/TR/vc-data-model/#types"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"validFrom"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date-time"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Date and time when a credential becomes valid."</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"validUntil"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date-time"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Date and time when a credential becomes valid."</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"$ref"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#/definitions/issuer"</span><span class="w"> </span><span class="p">},</span><span class="w">



   </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Template name to be use by template renderer to determine the template to use"</span><span class="w">
       </span><span class="p">},</span><span class="w">
       </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Type of renderer template"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"enum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"EMBEDDED_RENDERER"</span><span class="p">]</span><span class="w">
       </span><span class="p">},</span><span class="w">
       </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"URL of a decentralised renderer to render this document"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"pattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^(https?)://"</span><span class="w">
       </span><span class="p">}</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"url"</span><span class="p">],</span><span class="w">
     </span><span class="nl">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Proof method name as explained by https://www.w3.org/TR/vc-data-model/#types"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"enum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"OpenAttestationSignature2018"</span><span class="p">]</span><span class="w">
       </span><span class="p">},</span><span class="w">
       </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Proof open attestation method"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"enum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"TOKEN_REGISTRY"</span><span class="p">,</span><span class="w"> </span><span class="s2">"DOCUMENT_STORE"</span><span class="p">]</span><span class="w">
       </span><span class="p">},</span><span class="w">
       </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Proof value for issuer(s)"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
       </span><span class="p">}</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"method"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value"</span><span class="p">],</span><span class="w">
     </span><span class="nl">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"recipient"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Recipient's name"</span><span class="w">
       </span><span class="p">}</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="nl">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"attachments"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
       </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span><span class="w">
       </span><span class="nl">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"filename"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
           </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Name of attachment, with appropriate extensions"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
           </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A valid evidence type as explained by https://www.w3.org/TR/vc-data-model/#types"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"mimeType"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
           </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mime-type of attachment"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"enum"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"application/pdf"</span><span class="p">,</span><span class="w"> </span><span class="s2">"image/png"</span><span class="p">,</span><span class="w"> </span><span class="s2">"image/jpeg"</span><span class="p">]</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
           </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Base64 encoding of attachment"</span><span class="w">
         </span><span class="p">}</span><span class="w">
       </span><span class="p">},</span><span class="w">
       </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"filename"</span><span class="p">,</span><span class="w"> </span><span class="s2">"mimeType"</span><span class="p">,</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w"> </span><span class="s2">"type"</span><span class="p">],</span><span class="w">
       </span><span class="nl">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
     </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
 </span><span class="p">},</span><span class="w">



 </span><span class="nl">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"reference"</span><span class="p">,</span><span class="w"> </span><span class="s2">"issuer"</span><span class="p">,</span><span class="w"> </span><span class="s2">"template"</span><span class="p">,</span><span class="w"> </span><span class="s2">"proof"</span><span class="p">,</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"validFrom"</span><span class="p">],</span><span class="w">
 </span><span class="nl">"additionalProperties"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">


</span></code></pre></div></div>

<h2 id="intellectual-property">Intellectual Property</h2>

<p>All material published on edi3.org including all parts of this specification remain the intellectual property of the contributor.  However, contributors should participate on the basis that the specification IP may be incoprporated into a UN/CEFACT standard and, in that case, the IP rights will transfer to the UN as per the <a href="https://www.unece.org/fileadmin/DAM/cefact/cf_plenary/plenary12/ECE_TRADE_C_CEFACT_2010_20_Rev2E_UpdatedIPRpolicy.pdf">UN/CEFACT IPR Policy</a>.</p>

<h2 id="license">License</h2>

<p>This Specification is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version. See http://www.gnu.org/licenses.</p>

<h2 id="change-process">Change Process</h2>

<p>This document is governed by the <a href="http://rfc.unprotocols.org/spec:2/COSS/">2/COSS</a> (COSS).</p>

<h2 id="language">Language</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” 
in this document are to be interpreted as described in RFC 2119.</p>

<h2 id="glossary">Glossary</h2>

<table>
  <thead>
    <tr>
      <th>Phrase</th>
      <th>Definition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h2 id="dependencies">Dependencies</h2>

<p>This specification depends on the following specifications</p>

<ul>
  <li>spec 1</li>
  <li>spec 2</li>
</ul>

<p>The following specifications depends on this specification</p>

<ul>
  <li>spec 1</li>
  <li>spec 2</li>
</ul>

<h2 id="related-information">Related Information</h2>

<p><em>put a list of any relevant referneces here, and link to them from the appropriate part of the specification</em></p>

            
        </div>
    </div>
</div>
<footer class="footer">
    <a href="/" class="footer-logo"><img src="/images/logo-horisontal-white.svg" alt=""></a>
    <ul class="footer-menu">
        <li><a href="http://edi3.org/about">About edi3</a></li>
        <li><a href="https://github.com/edi3" target="_blank">Github</a></li>
        <li><a href="http://eepurl.com/dMLfdU" target="_blank">Newsletter</a></li>
        <li><a href="https://join.slack.com/t/edi3/shared_invite/enQtNTY5OTkzMjQ0NjcyLTAxZGVlMzJmNWQ5MDBjOTRmMWViNGU0MzdhY2VkOWIwZWY3ODMxOWE4YTJmZjdiNTBkYzczZDk5Y2ViOWJlNzQ" target="_blank">Join</a> <a href="https://edi3.slack.com/messages/general/" target="_blank">team</a></li>
    </ul>
    <div class="footer-credits">
        This page was generated by GitHub Pages.
        Comments, issues and suggestions are welcome in the <a href="https://github.com/edi3/edi3.github.io/issues/new">ticket system</a>.
        Pull requests welcome in the <a href="https://github.com/edi3/edi3.github.io/">site repository</a>.
    </div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-135810483-1', 'auto');
  ga('send', 'pageview');

</script>

<script src="/js/anchor.min.js"></script>
<script>
    anchors.add('h1, h2, h3, h4, h5');
    anchors.remove('.no-anchor, .page-content > h1:first-child');
</script>
</body>
</html>